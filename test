#!/bin/bash

set -e
echo "Running unittests"

# Run parallel-safe tests first (excludes @pytest.mark.serial tests)
echo "==> Running parallel tests..."
uv run pytest -n auto -m "not serial" tests -v --durations=0

# Run serial tests sequentially (includes IWYU and build_run tests)
echo "==> Running serial tests..."
uv run pytest -m "serial" tests -v --durations=0
